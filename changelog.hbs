# About this Release

Initial Release of the Rust rewrite of dlang-prs.

Available Downloads:

- Command Line (CLI Program): `prs-rs-cli`
- C Bindings: `C-Library-*`
- NuGet (C#): [prs_rs.Net.Sys](https://www.nuget.org/packages/prs_rs.Net.Sys)

## Version 2.0.2

Fixed decompression failures in release builds on newer Rust compilers.

```rust
// Obtain the offset. (negative i32, truncated to byte)
// We lost our negative sign when we originally wrote the offset, doing -0x100 will restore it.
let offset = read_byte(source) as isize | -0x100;
let src_addr = dest_local.add(offset as usize); // ‚Üê Undefined Behaviour HERE, offset may be huge, causing
overflow/wrapping
```

Now replaced with:

```rust
let offset = read_byte(source) as isize | -0x100;
let src_addr = dest_local.wrapping_add(offset as usize); // ‚Üê No UB. Wrapping is explicitly allowed.
```

No change in generated assembly from before.

There was an error in my code, where I wrote `add()` instead of `wrapping_add()`.

Newer Rust compilers found an optimization, under the assumption the value cannot overflow;
but because this wasn't true, newer source builds on newer compilers produced incorrect code. This fixes it.

Previous binaries are safe; including C & C# libraries- this only affects source builds with newer compilers.
CI now also tests release mode; just in case.

## Version 2.0.0

This version carries the following improvements:

- Compressor 'Dictionary' will be reused (if possible) when compressing last block.
* Improves performance by ~1.5% on 132KB files.

- Added Support for Custom Memory Allocators (Rust API Only)
* This allows you to split up the short and long lived memory allocations.
* Potentially useful if compressing in real time.

- Fixed regression where long sequences of repeated bytes compressed slower than they should.
* This happened because zero extending bytes (`movzx`) was slower than reading a pure `u32` in x86.
* Improves speed from 200MB to 400MB/s on a file of pure `00`s.

## Complete Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## Complete Changes

{{#each releases}}
{{#if href}}
## [{{title}}]({{href}}){{#if tag}} - {{isoDate}}{{/if}}
{{else}}
## {{title}}{{#if tag}} - {{isoDate}}{{/if}}
{{/if}}

{{#if summary}}
{{summary}}
{{/if}}

{{#if merges}}
### Merged

{{#each merges}}
- {{#if commit.breaking}}**Breaking change:** {{/if}}{{message}} {{#if href}}[`#{{id}}`]({{href}}){{/if}}
{{/each}}
{{/if}}

{{#if fixes}}
### Fixed

{{#each fixes}}
- {{#if commit.breaking}}**Breaking change:** {{/if}}{{commit.subject}}{{#each fixes}} {{#if
href}}[`#{{id}}`]({{href}}){{/if}}{{/each}}
{{/each}}
{{/if}}

{{#commit-list commits heading='### Commits'}}
- {{#if breaking}}**Breaking change:** {{/if}}{{subject}} {{#if href}}[`{{shorthash}}`]({{href}}){{/if}}
{{/commit-list}}

{{/each}}

====

{{#unless options.hideCredit}}
Reloaded changelogs are generated by [`auto-changelog`](https://github.com/CookPete/auto-changelog) üòá.
{{/unless}}